@startuml

<style>
document {
  BackGroundColor white
}
</style>

title presaleClaims() - Unstaking Flow\n(Failed Path - Unstaking Errors)

participant "presaleStaking" as caller
participant "presaleClaims" as presale #FFD700

caller -> presale : presaleClaims(_isStaking=false, _user)
activate presale #FFD700

alt #f5b7b1 allowPublicStaking.flag == true
    presale -x caller : Revert with PresaleStakingDisabled
    note right : PHASE ENDED:\nPresale closed when\npublic staking opens

else #white allowPublicStaking == false
    alt #f5b7b1 userPresaleStaker[_user].isAllow == false
        presale -x caller : Revert with UserIsNotPresaleStaker
        note right : NOT WHITELISTED:\nUser not in approved\npresale staker list
    
    else #white User is whitelisted
        alt #f5b7b1 userPresaleStaker[_user].stakingAmount == 0
            presale -x caller : Revert with UserPresaleStakerLimitExceeded
            note right : ERROR: Cannot unstake\nwhen stakingAmount is 0\n(No tokens staked)
        
        else #white User has staked tokens
            presale -> presale : userPresaleStaker[_user].stakingAmount--
            presale --> caller : Success
            deactivate presale
        end
    end
end

@enduml